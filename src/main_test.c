#include <p30f6014A.h>#include <stdlib.h>//for random numbers#include "stdio.h"#include "string.h"#include "math.h"#include "e_led.h"#include "e_epuck_ports.h"#include "e_init_port.h"#include "e_motors.h"#include "utility.h"#include "e_prox.h"#include "e_ad_conv.h"#include "e_uart_char.h"#include "e_poxxxx.h"#define path_obstructed_right()	prox_values[0] > 300 || prox_values[1] > 300 ||\				prox_values[2] > 300#define path_obstructed_left()	prox_values[7] > 300 || prox_values[6] > 300 ||\				prox_values[5] > 300/* Camera config */#define IMG_H	40#define IMG_W	40#define IMG_SS	1#define capture_image(buf)	e_poxxxx_launch_capture(buf);	\				while(!e_poxxxx_is_img_ready())int sel; //the position of the selector switchchar img_buf[3 + 2*(IMG_H/IMG_SS)*(IMG_W/IMG_SS)];/* * Timer usage: * * Used: * Timer 1 - used by proximity sensors * Timer 3 - used by motor control * Timer 4 - used by camera * Timer 5 - used by camera * * Unused: * Timer 2 */void wait_for_cmd(char cmd) {	char rcv;	do {		e_getchar_uart1(&rcv);	} while(rcv != cmd);}int main(void){	int prox_values[8] = {0, 0, 0, 0, 0, 0, 0, 0};	int closest;	int closest_index;	int speed = 200;	int i;	int img_cnt = 0;	char c;	myWait(500); //saftey wait period to prevent UART clogging	/* Init */	sel = getselector();	if (sel == 0) while (1) NOP();	if(sel == 1) {		/* We don't have to call e_init_ports() because e_init_motors()		 * does that for us */		e_init_motors();		e_init_prox();	}	if(sel == 2) {		e_init_port();		e_init_uart1();		while(!e_ischar_uart1());		e_send_uart1_char("Hello World!\n\r", 14);	}	if(sel == 3) {		e_init_uart1();		e_poxxxx_init_cam();		e_poxxxx_config_cam((ARRAY_WIDTH - (IMG_W * IMG_SS))/2,			(ARRAY_HEIGHT - (IMG_H * IMG_SS))/2, IMG_W * IMG_SS,			IMG_H * IMG_SS, IMG_SS, IMG_SS, RGB_565_MODE);		e_poxxxx_write_cam_registers();	}	while (1) {		/* movement test */		if(sel == 1) {			/* determine which sensor sees the closest object */			closest = 0;			for (i = 0; i < 8; i++) {				prox_values[i] = e_get_prox(i);				if (prox_values[i] > closest) {					closest = prox_values[i];					closest_index = i;				}			}			/* indicate the direction of the closest object by turning on			 * the LED facing it */			allRedLEDsOff();			setLED(closest_index, 1);			/* check if the current path is obstructed and react */			if(path_obstructed_right()) {				setSpeeds(-speed, speed);			} else if(path_obstructed_left()) {				setSpeeds(speed, -speed);			} else {				setSpeeds(speed, speed);			}			myWait(100);		}		/* bluetooth comm test */		if(sel == 2) {			while(e_uart1_sending() || !e_ischar_uart1());			e_getchar_uart1(&c);			e_send_uart1_char("You have wrote: ", 16);			e_send_uart1_char(&c, 1);			e_send_uart1_char("\r\n\r\n",4);		}		/* camera test */		if(sel == 3) {			wait_for_cmd('s');			img_buf[0] = IMG_H;			img_buf[1] = IMG_W;			img_buf[2] = IMG_SS;			capture_image(img_buf + 3);			e_send_uart1_char(img_buf, sizeof(img_buf));			img_cnt++;		}			}}